meta {
  name: upload_attachment
  type: http
  seq: 1
}

post {
  url: {{base_url}}/{{context}}
  body: multipartForm
  auth: inherit
}

headers {
  x-csrf-token: {{csrf_token}}
}

vars:pre-request {
  context: {{Attachment.Context.SUBMISSION_CODE}}
  file: code_accepted.py
}

script:pre-request {
  const FormData = require('form-data');
  const fs = require("fs");
  const path = require("path");
  
  const file = bru.getVar("file") || bru.getRequestVar("file");
  const absolutePath = path.join(__dirname, "../regression/test/files/", file);
  
  const buffer = fs.createReadStream(absolutePath);
  
  const data = new FormData();
  data.append("file", buffer); 
  
  req.setBody(data);
}

settings {
  encodeUrl: true
  timeout: 0
}
