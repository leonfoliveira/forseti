meta {
  name: create_submission
  type: http
  seq: 1
}

post {
  url: {{base_url}}
  body: json
  auth: inherit
}

headers {
  x-csrf-token: {{csrf_token}}
}

body:json {
  {
    "problemId": "{{problem_id}}",
    "language": "{{Submission.Language.PYTHON_312}}",
    "code": {
      "id": "{{code_attachment_id}}"
    }
  }
}

vars:pre-request {
  problem_id: 123
  code_attachment_id: 123
}

script:pre-request {
  async function uploadFile(file, context) {  
    bru.setVar("file", file)
    bru.setVar("context", context)
    const response = await bru.runRequest("contest/attachment/upload_attachment")
    console.log(response)
    return response.data
  }
  
  const codeAttachment = await uploadFile("code_accepted.py", "SUBMISSION_CODE")
  
  bru.setVar("code_attachment_id", codeAttachment.id)
}

settings {
  encodeUrl: true
  timeout: 0
}
