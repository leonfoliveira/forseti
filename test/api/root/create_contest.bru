meta {
  name: create_contest
  type: http
  seq: 5
}

post {
  url: {{base_url}}/contests
  body: json
  auth: inherit
}

headers {
  x-csrf-token: {{csrf_token}}
}

body:json {
  {
    "slug": "{{$randomWord}}",
    "title": "{{$randomWords}}",
    "languages": [
      "{{Submission.Language.CPP_17}}",
      "{{Submission.Language.JAVA_21}}",
      "{{Submission.Language.PYTHON_312}}"
    ],
    "startAt": "{{start_at}}",
    "endAt": "{{end_at}}"
  }
}

script:pre-request {
  const startAt = new Date(new Date().getTime() + 60 * 60 * 1000).toISOString()
  const endAt = new Date(new Date().getTime() + 2 * 60 * 60 * 1000).toISOString()
  
  bru.setVar("start_at", startAt)
  bru.setVar("end_at", endAt)
}

script:post-response {
  const contestId = res.body.id;
  const contestSlug = res.body.slug;
  
  bru.setVar("contest_id", contestId)
  bru.setVar("contest_slug", contestSlug)
}

settings {
  encodeUrl: true
  timeout: 0
}
